<!DOCTYPE html>
<html>
<head>
    <title>Emergency Vehicle Notification System</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header>
        <div class="logo">
            <img src="/static/images/logo.png" alt="logo">
        </div>
        <div class="last-update">
            <p id="lastUpdate"></p>
        </div>
    </header>
    <h1>Emergency Vehicle Notification System</h1>
    <p class="description">This system helps to track the location of emergency vehicles in real-time and notify nearby cars and traffic lights to help drivers quickly and safely move out of the way of the emergency vehicle.</p>
    <div id="googleMap"></div>
    
    <div class='my-legend'>
        <div class='legend-title'>Legend</div>
        <div class='legend-scale'>
          <ul class='legend-labels'>
            <li><img src="/static/images/car.png" alt="Car" style="width:auto;height:auto;">Car</li>
            <li><img src="/static/images/ambulance.png" alt="Ambulance" style="width:auto;height:auto;">Ambulance</li>
            <li><img src="/static/images/police.png" alt="Police Car" style="width:auto;height:auto;">Police Car</li>
            <li><img src="/static/images/fire.png" alt="Firefighters" style="width:auto;height:auto;">Firefighters</li>
            <li><img src="/static/images/hospital-building.png" alt="Hospital" style="width:auto;height:auto;">Hospital</li>
            <li><img src="/static/images/trafficlight.png" alt="Traffic Lights" style="width:auto;height:auto;">Traffic Lights</li>
            <li><img src="/static/images/rsu.png" alt="RSU" style="width: 30px; height: 30px;">RSU</li>
          </ul>
        </div>
    </div>    
        
    <script>
        var map;
        var cars;
        var ambulance;
        var police;
        var firefighters;
        var hospital;
        var traffic_lights;
        
        function myMap() {
            var mapProp= {
                center:new google.maps.LatLng(40.634723, -8.655046),
                zoom:16,
                styles: [{featureType: "poi", stylers: [{visibility: "off"}]}]
            };
            map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
            
            var carIcon = {
            url: "/static/images/car.png",
            scaledSize: new google.maps.Size(30, 30),
            };

            var ambulanceIcon = {
            url: "/static/images/ambulance.png",
            scaledSize: new google.maps.Size(30, 30),
            };

            var policeIcon = {
            url: "/static/images/police.png",
            scaledSize: new google.maps.Size(30, 30),
            };

            var firefightersIcon = {
            url: "/static/images/fire.png",
            scaledSize: new google.maps.Size(30, 30),
            };

            var hospitalIcon = {
            url: "/static/images/hospital-building.png",
            scaledSize: new google.maps.Size(40, 40),
            };

            var traffic_lightsIcon = {
            url: "/static/images/trafficlight.png",
            scaledSize: new google.maps.Size(40, 40),
            };
            
            var rsuIcon = {
            url: "/static/images/rsu.png",
            scaledSize: new google.maps.Size(30, 30),
            };

            cars = new google.maps.Marker({
                position: new google.maps.LatLng(40.64091,-8.659),
                map: map,
                icon: carIcon,
            }); 

            ambulance = new google.maps.Marker({
                position: new google.maps.LatLng(40.63524,-8.65542),
                map: map,
                icon: ambulanceIcon,
            });

            police = new google.maps.Marker({
                position: new google.maps.LatLng(40.6305, -8.65402),
                map: map,
                icon: policeIcon,
            });

            firefighters = new google.maps.Marker({
                position: new google.maps.LatLng(40.6406, -8.64841),
                map: map,
                icon: firefightersIcon,
            });

            hospital = new google.maps.Marker({
                position: new google.maps.LatLng(40.634723, -8.655046),
                map: map,
                icon: hospitalIcon,
            });

            traffic_lights = new google.maps.Marker({
                position: new google.maps.LatLng(40.637076, -8.653228),
                map: map,
                icon: traffic_lightsIcon,
            });                

            // get the rsu variable from app.py
            var rsu = {{ rsu|tojson }};

            // get the obu variable from app.py
            var obu = {{ obu|tojson }};
            
            // loop through the list and add markers
            for (var i = 0; i < rsu.length; i++) {
                var rsuMarker = new google.maps.Marker({
                    position: new google.maps.LatLng(rsu[i][1], rsu[i][2]),
                    map: map,
                    icon: rsuIcon,
                });
            }

            // Function to update the content with the latest data
            function updateContent() {
                $.get("/get_data", function(data) {
                    ambulance.setPosition(new google.maps.LatLng(data.obu[0][1], data.obu[0][2]));
                    cars.setPosition(new google.maps.LatLng(data.obu[1][1], data.obu[1][2]));
                    police.setPosition(new google.maps.LatLng(data.obu[2][1], data.obu[2][2]));
                    firefighters.setPosition(new google.maps.LatLng(data.obu[3][1], data.obu[3][2]));
                    
                    // Update the last update time
                    var now = new Date();
                    document.getElementById("lastUpdate").innerHTML = "Last update: " + now.toLocaleString();
                });
            }
            // Periodically update the content every 500ms
            setInterval(updateContent, 500);
        }
    </script>
   
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcLG_2KgktdQJXLaeyQZHJzmvcSjNwoPM&callback=myMap"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


</body>
</html>